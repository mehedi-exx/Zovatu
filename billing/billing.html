<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Zovatu ржЙржирзНржиржд ржмрж┐рж▓рж┐ржВ рж╕рж┐рж╕рзНржЯрзЗржо</title>
  <link rel="stylesheet" href="enhanced-billing.css" />
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
  
  <!-- Authentication Check -->
  <script>
    window.addEventListener('DOMContentLoaded', function() {
      const loggedInUser = localStorage.getItem('loggedInUser');
      if (!loggedInUser) {
        alert('ржЖржкржирж╛ржХрзЗ ржкрзНрж░ржержорзЗ рж▓ржЧржЗржи ржХрж░рждрзЗ рж╣ржмрзЗ ржмрж┐рж▓рж┐ржВ рж╕рзЗржХрж╢ржирзЗ ржкрзНрж░ржмрзЗрж╢рзЗрж░ ржЬржирзНржпред');
        window.location.href = '../index.html';
        return;
      }
      
      // Show logged in user info
      const userInfo = document.createElement('div');
      userInfo.className = 'user-info';
      userInfo.innerHTML = `
        <div class="logged-user">
          <span>рж▓ржЧржЗржиржХрзГржд ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА: <strong>${loggedInUser}</strong></span>
          <button onclick="logout()" class="logout-btn">рж▓ржЧржЖржЙржЯ</button>
        </div>
      `;
      document.body.insertBefore(userInfo, document.body.firstChild);
    });
    
    function logout() {
      if (confirm('ржЖржкржирж┐ ржХрж┐ ржирж┐рж╢рзНржЪрж┐ржд ржпрзЗ рж▓ржЧржЖржЙржЯ ржХрж░рждрзЗ ржЪрж╛ржи?')) {
        localStorage.removeItem('loggedInUser');
        window.location.href = '../index.html';
      }
    }
  </script>
</head>
<body>
  <div class="container">
    <header class="main-header">
      <h1>ЁЯз╛ Zovatu ржЙржирзНржиржд ржмрж┐рж▓рж┐ржВ рж╕рж┐рж╕рзНржЯрзЗржо</h1>
      <nav class="tab-navigation">
        <button class="tab-btn active" onclick="showTab('products')">ЁЯУж ржкрзНрж░рзЛржбрж╛ржХрзНржЯ</button>
        <button class="tab-btn" onclick="showTab('customers')">ЁЯСе ржХрж╛рж╕рзНржЯржорж╛рж░</button>
        <button class="tab-btn" onclick="showTab('invoice')">ЁЯз╛ ржЗржиржнржпрж╝рзЗрж╕</button>
        <button class="tab-btn" onclick="showTab('reports')">ЁЯУК рж░рж┐ржкрзЛрж░рзНржЯ</button>
      </nav>
    </header>

    <!-- Products Tab -->
    <div id="products-tab" class="tab-content active">
      <section class="add-product-section">
        <h2>ЁЯУж ржирждрзБржи ржкрзНрж░рзЛржбрж╛ржХрзНржЯ ржпрзЛржЧ ржХрж░рзБржи</h2>
        <div class="form-grid">
          <input id="newProductName" placeholder="ржкрзНрж░рзЛржбрж╛ржХрзНржЯрзЗрж░ ржирж╛ржо *" required>
          <input id="newProductCode" placeholder="ржкрзНрж░рзЛржбрж╛ржХрзНржЯ ржХрзЛржб (ржРржЪрзНржЫрж┐ржХ)">
          <input id="newProductPrice" type="number" placeholder="ржорзВрж▓рзНржп *" step="0.01" required>
          <input id="newProductCategory" placeholder="ржХрзНржпрж╛ржЯрж╛ржЧрж░рж┐">
          <input id="newProductStock" type="number" placeholder="рж╕рзНржЯржХ ржкрж░рж┐ржорж╛ржг" min="0">
          <input id="newProductMinStock" type="number" placeholder="рж╕рж░рзНржмржирж┐ржорзНржи рж╕рзНржЯржХ" min="0" value="5">
        </div>
        <button onclick="addProduct()" class="btn-primary">тЮХ ржкрзНрж░рзЛржбрж╛ржХрзНржЯ ржпрзЛржЧ ржХрж░рзБржи</button>

        <!-- Auto Barcode -->
        <div class="barcode-section">
          <h3>ржЬрзЗржирж╛рж░рзЗржЯрзЗржб ржмрж╛рж░ржХрзЛржб:</h3>
          <div class="barcode-container">
            <svg id="autoBarcode"></svg>
          </div>
          <button onclick="printAutoBarcode()" class="btn-secondary">ЁЯЦия╕П ржмрж╛рж░ржХрзЛржб ржкрзНрж░рж┐ржирзНржЯ ржХрж░рзБржи</button>
        </div>
      </section>

      <section class="product-list-section">
        <h2>ЁЯУГ ржкрзНрж░рзЛржбрж╛ржХрзНржЯ рждрж╛рж▓рж┐ржХрж╛</h2>
        <div class="search-box">
          <input type="text" placeholder="ржкрзНрж░рзЛржбрж╛ржХрзНржЯ ржЦрзБржБржЬрзБржи..." onkeyup="searchProducts(this.value)">
        </div>
        <div id="productList" class="product-grid"></div>
      </section>
    </div>

    <!-- Customers Tab -->
    <div id="customers-tab" class="tab-content">
      <section class="add-customer-section">
        <h2>ЁЯСе ржирждрзБржи ржХрж╛рж╕рзНржЯржорж╛рж░ ржпрзЛржЧ ржХрж░рзБржи</h2>
        <div class="form-grid">
          <input id="newCustomerName" placeholder="ржХрж╛рж╕рзНржЯржорж╛рж░рзЗрж░ ржирж╛ржо *" required>
          <input id="newCustomerPhone" placeholder="ржлрзЛржи ржиржорзНржмрж░ *" required>
          <input id="newCustomerEmail" type="email" placeholder="ржЗржорзЗржЗрж▓ (ржРржЪрзНржЫрж┐ржХ)">
          <textarea id="newCustomerAddress" placeholder="ржарж┐ржХрж╛ржирж╛" rows="2"></textarea>
        </div>
        <button onclick="addCustomer()" class="btn-primary">тЮХ ржХрж╛рж╕рзНржЯржорж╛рж░ ржпрзЛржЧ ржХрж░рзБржи</button>
      </section>

      <section class="customer-list-section">
        <h2>ЁЯСе ржХрж╛рж╕рзНржЯржорж╛рж░ рждрж╛рж▓рж┐ржХрж╛</h2>
        <div id="customerList" class="customer-grid"></div>
      </section>
    </div>

    <!-- Invoice Tab -->
    <div id="invoice-tab" class="tab-content">
      <section class="invoice-section">
        <h2>ЁЯз╛ ржЗржиржнржпрж╝рзЗрж╕ рждрзИрж░рж┐</h2>
        
        <div class="invoice-header">
          <div class="customer-selection">
            <label>ржирж┐рж░рзНржмрж╛ржЪрж┐ржд ржХрж╛рж╕рзНржЯржорж╛рж░: <span id="selectedCustomer">ржХрзЛржи ржХрж╛рж╕рзНржЯржорж╛рж░ ржирж┐рж░рзНржмрж╛ржЪрж┐ржд ржиржпрж╝</span></label>
          </div>
        </div>

        <div class="invoice-table-container">
          <table id="invoiceTable" class="invoice-table">
            <tr><td colspan="6" class="no-data">ржЗржиржнржпрж╝рзЗрж╕рзЗ ржХрзЛржи ржЖржЗржЯрзЗржо ржирзЗржЗ</td></tr>
          </table>
        </div>

        <div class="invoice-summary">
          <div class="summary-row">
            <span>рж╕рж╛ржмржЯрзЛржЯрж╛рж▓:</span>
            <span id="subtotalAmount">рз│0.00</span>
          </div>
          <div class="summary-row">
            <span>ржЯрзНржпрж╛ржХрзНрж╕ (рзл%):</span>
            <span id="taxAmount">рз│0.00</span>
          </div>
          <div class="summary-row">
            <span>ржбрж┐рж╕ржХрж╛ржЙржирзНржЯ:</span>
            <span id="discountAmount">рз│0.00</span>
          </div>
          <div class="summary-row total-row">
            <span>ржорзЛржЯ:</span>
            <span>рз│<span id="totalAmount">0.00</span></span>
          </div>
        </div>

        <div class="invoice-actions">
          <button onclick="generateInvoice()" class="btn-success">тЬЕ ржЗржиржнржпрж╝рзЗрж╕ рждрзИрж░рж┐ ржХрж░рзБржи</button>
          <button onclick="printInvoice()" class="btn-primary">ЁЯЦия╕П ржкрзНрж░рж┐ржирзНржЯ ржХрж░рзБржи</button>
          <button onclick="clearInvoice()" class="btn-secondary">ЁЯЧСя╕П ржХрзНрж▓рж┐ржпрж╝рж╛рж░ ржХрж░рзБржи</button>
        </div>
      </section>
    </div>

    <!-- Reports Tab -->
    <div id="reports-tab" class="tab-content">
      <section class="reports-section">
        <h2>ЁЯУК ржмрж┐ржХрзНрж░ржпрж╝ рж░рж┐ржкрзЛрж░рзНржЯ</h2>
        
        <div class="report-filters">
          <select id="reportType">
            <option value="daily">ржжрзИржирж┐ржХ</option>
            <option value="weekly">рж╕рж╛ржкрзНрждрж╛рж╣рж┐ржХ</option>
            <option value="monthly">ржорж╛рж╕рж┐ржХ</option>
            <option value="yearly">ржмрж╛рж░рзНрж╖рж┐ржХ</option>
          </select>
          <input type="date" id="reportDate" value="">
          <button onclick="generateReport()" class="btn-primary">рж░рж┐ржкрзЛрж░рзНржЯ рждрзИрж░рж┐ ржХрж░рзБржи</button>
        </div>

        <div id="reportContainer" class="report-container">
          <p class="no-data">рж░рж┐ржкрзЛрж░рзНржЯ рждрзИрж░рж┐ ржХрж░рждрзЗ ржЙржкрж░рзЗрж░ ржмрж╛ржЯржирзЗ ржХрзНрж▓рж┐ржХ ржХрж░рзБржи</p>
        </div>
      </section>

      <!-- Backup & Restore Section -->
      <section class="backup-section">
        <h2>ЁЯТ╛ ржмрзНржпрж╛ржХржЖржк ржПржмржВ рж░рж┐рж╕рзНржЯрзЛрж░</h2>
        <div class="backup-actions">
          <button onclick="backupData()" class="btn-primary">тмЗя╕П ржбрж╛ржЯрж╛ ржмрзНржпрж╛ржХржЖржк ржХрж░рзБржи</button>
          <input type="file" id="importFile" accept=".json" onchange="importData(event)" style="display: none;">
          <button onclick="document.getElementById('importFile').click()" class="btn-secondary">тмЖя╕П ржбрж╛ржЯрж╛ ржЗржоржкрзЛрж░рзНржЯ ржХрж░рзБржи</button>
        </div>
      </section>
    </div>
  </div>

  <script src="enhanced-billing.js"></script>
  <script>
    // Tab functionality
    function showTab(tabName) {
      // Hide all tabs
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Remove active class from all buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Show selected tab
      document.getElementById(tabName + '-tab').classList.add('active');
      
      // Add active class to clicked button
      event.target.classList.add('active');
    }

    // Search functionality
    function searchProducts(query) {
      const productItems = document.querySelectorAll('.product-item');
      productItems.forEach(item => {
        const productName = item.querySelector('h4').textContent.toLowerCase();
        const productCode = item.querySelector('p').textContent.toLowerCase();
        
        if (productName.includes(query.toLowerCase()) || productCode.includes(query.toLowerCase())) {
          item.style.display = 'block';
        } else {
          item.style.display = 'none';
        }
      });
    }

    // Clear invoice function
    function clearInvoice() {
      if (confirm('ржЖржкржирж┐ ржХрж┐ ржирж┐рж╢рзНржЪрж┐ржд ржпрзЗ ржЗржиржнржпрж╝рзЗрж╕ ржХрзНрж▓рж┐ржпрж╝рж╛рж░ ржХрж░рждрзЗ ржЪрж╛ржи?')) {
        currentInvoice.items = [];
        currentInvoice.customerId = '';
        calculateInvoiceTotal();
        renderInvoice();
        document.getElementById('selectedCustomer').textContent = 'ржХрзЛржи ржХрж╛рж╕рзНржЯржорж╛рж░ ржирж┐рж░рзНржмрж╛ржЪрж┐ржд ржиржпрж╝';
        showToast('ржЗржиржнржпрж╝рзЗрж╕ ржХрзНрж▓рж┐ржпрж╝рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ', 'success');
      }
    }

    // Generate report function
    function generateReport() {
      const reportType = document.getElementById('reportType').value;
      const reportDate = document.getElementById('reportDate').value;
      const container = document.getElementById('reportContainer');
      
      if (!reportDate) {
        showToast('ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ ржПржХржЯрж┐ рждрж╛рж░рж┐ржЦ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи', 'error');
        return;
      }
      
      // Simple report generation (can be enhanced)
      const totalSales = invoices.length;
      const totalRevenue = invoices.reduce((sum, inv) => sum + inv.total, 0);
      
      container.innerHTML = `
        <div class="report-summary">
          <h3>${reportType} рж░рж┐ржкрзЛрж░рзНржЯ - ${reportDate}</h3>
          <div class="report-stats">
            <div class="stat-card">
              <h4>ржорзЛржЯ ржмрж┐ржХрзНрж░ржпрж╝</h4>
              <p>${totalSales}</p>
            </div>
            <div class="stat-card">
              <h4>ржорзЛржЯ ржЖржпрж╝</h4>
              <p>рз│${totalRevenue.toFixed(2)}</p>
            </div>
            <div class="stat-card">
              <h4>ржЧржбрж╝ ржмрж┐ржХрзНрж░ржпрж╝</h4>
              <p>рз│${totalSales > 0 ? (totalRevenue / totalSales).toFixed(2) : '0.00'}</p>
            </div>
          </div>
        </div>
      `;
    }

    // Set today's date as default
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('reportDate').value = new Date().toISOString().split('T')[0];
    });
  </script>
</body>
</html>
