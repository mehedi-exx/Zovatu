<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Zovatu Smart Billing Tool - Professional billing and invoice management">
    <meta name="keywords" content="billing, invoice, POS, barcode, receipt">
    <meta name="author" content="Zovatu Team">
    
    <!-- PWA Support -->
    <meta name="theme-color" content="#ff6b35">
    <link rel="manifest" href="../manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../assets/icons/zovatu-icon.png">
    
    <title>Zovatu Smart Billing Tool</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/components.css">
    <link rel="stylesheet" href="../assets/css/responsive.css">
    <link rel="stylesheet" href="billing.css">
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- JsBarcode for Barcode Generation -->
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    
    <!-- QR Code Generator -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>
<body class="billing-page">
    <!-- Header -->
    <header class="billing-header">
        <div class="header-left">
            <button class="back-btn" onclick="window.location.href='../dashboard.html'">
                <i class="fas fa-arrow-left"></i>
                <span>Back to Dashboard</span>
            </button>
        </div>
        
        <div class="header-center">
            <div class="logo-section">
                <img src="../assets/icons/zovatu-icon.png" alt="Zovatu Logo" class="logo">
                <div class="title-section">
                    <h1>Smart Billing Tool</h1>
                    <p class="shop-status" id="shopStatus">No Shop Selected</p>
                </div>
            </div>
        </div>
        
        <div class="header-right">
            <div class="header-actions">
                <button class="action-btn mode-toggle" id="modeToggle">
                    <i class="fas fa-exchange-alt"></i>
                    <span class="mode-text">Ultra Mode</span>
                </button>
                
                <button class="action-btn settings-btn" id="settingsBtn">
                    <i class="fas fa-cog"></i>
                </button>
                
                <div class="shop-selector">
                    <button class="shop-btn" id="shopBtn">
                        <i class="fas fa-store"></i>
                        <span id="currentShopName">Select Shop</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="shop-dropdown" id="shopDropdown">
                        <div class="shop-list" id="shopList">
                            <!-- Shops will be loaded here -->
                        </div>
                        <div class="dropdown-divider"></div>
                        <button class="dropdown-item create-shop-btn" id="createShopBtn">
                            <i class="fas fa-plus"></i>
                            Create New Shop
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Shop Setup Modal -->
    <div class="modal" id="shopSetupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create New Shop</h2>
                <button class="modal-close" id="closeShopModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="shopSetupForm" class="shop-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="shopName">Shop Name *</label>
                            <input type="text" id="shopName" name="shopName" required placeholder="Enter shop name">
                        </div>
                        <div class="form-group">
                            <label for="shopType">Business Type</label>
                            <select id="shopType" name="shopType">
                                <option value="retail">Retail Store</option>
                                <option value="grocery">Grocery Store</option>
                                <option value="restaurant">Restaurant</option>
                                <option value="pharmacy">Pharmacy</option>
                                <option value="electronics">Electronics</option>
                                <option value="clothing">Clothing</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ownerName">Owner Name *</label>
                            <input type="text" id="ownerName" name="ownerName" required placeholder="Enter owner name">
                        </div>
                        <div class="form-group">
                            <label for="shopPhone">Phone Number *</label>
                            <input type="tel" id="shopPhone" name="shopPhone" required placeholder="Enter phone number">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="shopAddress">Address *</label>
                        <textarea id="shopAddress" name="shopAddress" required placeholder="Enter complete address" rows="3"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="shopEmail">Email</label>
                            <input type="email" id="shopEmail" name="shopEmail" placeholder="Enter email address">
                        </div>
                        <div class="form-group">
                            <label for="shopWebsite">Website</label>
                            <input type="url" id="shopWebsite" name="shopWebsite" placeholder="Enter website URL">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="taxNumber">Tax/VAT Number</label>
                            <input type="text" id="taxNumber" name="taxNumber" placeholder="Enter tax number">
                        </div>
                        <div class="form-group">
                            <label for="currency">Currency</label>
                            <select id="currency" name="currency">
                                <option value="BDT">৳ Bangladeshi Taka (BDT)</option>
                                <option value="USD">$ US Dollar (USD)</option>
                                <option value="EUR">€ Euro (EUR)</option>
                                <option value="GBP">£ British Pound (GBP)</option>
                                <option value="INR">₹ Indian Rupee (INR)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelShopSetup">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Shop</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="billing-main" id="billingMain">
        <!-- Shop Selection Screen -->
        <div class="shop-selection-screen" id="shopSelectionScreen">
            <div class="selection-content">
                <div class="selection-icon">
                    <i class="fas fa-store"></i>
                </div>
                <h2>Welcome to Zovatu Smart Billing</h2>
                <p>Please select a shop to start billing or create a new one</p>
                
                <div class="shop-cards" id="shopCards">
                    <!-- Shop cards will be loaded here -->
                </div>
                
                <button class="btn btn-primary create-shop-main" id="createShopMain">
                    <i class="fas fa-plus"></i>
                    Create New Shop
                </button>
            </div>
        </div>

        <!-- Billing Interface -->
        <div class="billing-interface" id="billingInterface" style="display: none;">
            <!-- Mode Selector -->
            <div class="mode-selector">
                <div class="mode-tabs">
                    <button class="mode-tab active" data-mode="simple">
                        <i class="fas fa-calculator"></i>
                        <span>Simple Mode</span>
                        <small>Quick calculations</small>
                    </button>
                    <button class="mode-tab" data-mode="ultra">
                        <i class="fas fa-barcode"></i>
                        <span>Ultra Mode</span>
                        <small>Product-based billing</small>
                    </button>
                </div>
            </div>

            <!-- Simple Mode -->
            <div class="billing-mode simple-mode active" id="simpleMode">
                <div class="billing-grid">
                    <!-- Calculator Section -->
                    <div class="calculator-section">
                        <div class="calculator-display">
                            <input type="text" id="calculatorDisplay" class="display-input" readonly value="0">
                            <div class="display-info">
                                <span class="item-count" id="itemCount">0 items</span>
                                <span class="total-amount" id="totalAmount">৳0.00</span>
                            </div>
                        </div>
                        
                        <div class="calculator-keypad">
                            <div class="keypad-row">
                                <button class="key-btn clear-btn" data-action="clear">C</button>
                                <button class="key-btn" data-action="backspace">⌫</button>
                                <button class="key-btn operator-btn" data-action="divide">÷</button>
                                <button class="key-btn operator-btn" data-action="multiply">×</button>
                            </div>
                            <div class="keypad-row">
                                <button class="key-btn number-btn" data-number="7">7</button>
                                <button class="key-btn number-btn" data-number="8">8</button>
                                <button class="key-btn number-btn" data-number="9">9</button>
                                <button class="key-btn operator-btn" data-action="subtract">-</button>
                            </div>
                            <div class="keypad-row">
                                <button class="key-btn number-btn" data-number="4">4</button>
                                <button class="key-btn number-btn" data-number="5">5</button>
                                <button class="key-btn number-btn" data-number="6">6</button>
                                <button class="key-btn operator-btn" data-action="add">+</button>
                            </div>
                            <div class="keypad-row">
                                <button class="key-btn number-btn" data-number="1">1</button>
                                <button class="key-btn number-btn" data-number="2">2</button>
                                <button class="key-btn number-btn" data-number="3">3</button>
                                <button class="key-btn equals-btn" data-action="equals" rowspan="2">=</button>
                            </div>
                            <div class="keypad-row">
                                <button class="key-btn number-btn zero-btn" data-number="0">0</button>
                                <button class="key-btn" data-action="decimal">.</button>
                                <button class="key-btn add-item-btn" data-action="add-item">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Bill Summary -->
                    <div class="bill-summary">
                        <div class="summary-header">
                            <h3>Bill Summary</h3>
                            <button class="clear-bill-btn" id="clearBill">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        
                        <div class="bill-items" id="billItems">
                            <div class="empty-bill">
                                <i class="fas fa-receipt"></i>
                                <p>No items added yet</p>
                            </div>
                        </div>
                        
                        <div class="bill-totals">
                            <div class="total-row">
                                <span>Subtotal:</span>
                                <span id="subtotal">৳0.00</span>
                            </div>
                            <div class="total-row">
                                <span>Tax (0%):</span>
                                <span id="taxAmount">৳0.00</span>
                            </div>
                            <div class="total-row">
                                <span>Discount:</span>
                                <span id="discountAmount">৳0.00</span>
                            </div>
                            <div class="total-row grand-total">
                                <span>Total:</span>
                                <span id="grandTotal">৳0.00</span>
                            </div>
                        </div>
                        
                        <div class="bill-actions">
                            <button class="btn btn-secondary" id="saveBill">
                                <i class="fas fa-save"></i>
                                Save
                            </button>
                            <button class="btn btn-primary" id="printBill">
                                <i class="fas fa-print"></i>
                                Print Bill
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ultra Mode -->
            <div class="billing-mode ultra-mode" id="ultraMode">
                <div class="ultra-grid">
                    <!-- Product Search & Barcode -->
                    <div class="product-search-section">
                        <div class="search-header">
                            <h3>Product Search</h3>
                            <button class="barcode-scan-btn" id="barcodeScanBtn">
                                <i class="fas fa-barcode"></i>
                                Scan Barcode
                            </button>
                        </div>
                        
                        <div class="search-bar">
                            <i class="fas fa-search"></i>
                            <input type="text" id="productSearch" placeholder="Search products by name, code, or barcode...">
                        </div>
                        
                        <div class="product-grid" id="productGrid">
                            <!-- Products will be loaded here -->
                        </div>
                        
                        <div class="product-actions">
                            <button class="btn btn-secondary" id="addProductBtn">
                                <i class="fas fa-plus"></i>
                                Add New Product
                            </button>
                            <button class="btn btn-secondary" id="manageProductsBtn">
                                <i class="fas fa-cog"></i>
                                Manage Products
                            </button>
                        </div>
                    </div>

                    <!-- Shopping Cart -->
                    <div class="shopping-cart">
                        <div class="cart-header">
                            <h3>Shopping Cart</h3>
                            <span class="cart-count" id="cartCount">0 items</span>
                        </div>
                        
                        <div class="cart-items" id="cartItems">
                            <div class="empty-cart">
                                <i class="fas fa-shopping-cart"></i>
                                <p>Cart is empty</p>
                                <small>Add products to start billing</small>
                            </div>
                        </div>
                        
                        <div class="cart-summary">
                            <div class="summary-row">
                                <span>Items:</span>
                                <span id="cartItemCount">0</span>
                            </div>
                            <div class="summary-row">
                                <span>Subtotal:</span>
                                <span id="cartSubtotal">৳0.00</span>
                            </div>
                            <div class="summary-row">
                                <span>Tax:</span>
                                <span id="cartTax">৳0.00</span>
                            </div>
                            <div class="summary-row total">
                                <span>Total:</span>
                                <span id="cartTotal">৳0.00</span>
                            </div>
                        </div>
                        
                        <div class="cart-actions">
                            <button class="btn btn-secondary" id="clearCart">
                                <i class="fas fa-trash"></i>
                                Clear Cart
                            </button>
                            <button class="btn btn-primary" id="checkoutBtn">
                                <i class="fas fa-credit-card"></i>
                                Checkout
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>Billing Settings</h2>
                <button class="modal-close" id="closeSettingsModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="settings-tabs">
                    <button class="settings-tab active" data-tab="general">General</button>
                    <button class="settings-tab" data-tab="invoice">Invoice</button>
                    <button class="settings-tab" data-tab="tax">Tax & Discount</button>
                    <button class="settings-tab" data-tab="backup">Backup</button>
                </div>
                
                <div class="settings-content">
                    <!-- General Settings -->
                    <div class="settings-panel active" id="generalSettings">
                        <h3>General Settings</h3>
                        <!-- Settings content will be added here -->
                    </div>
                    
                    <!-- Invoice Settings -->
                    <div class="settings-panel" id="invoiceSettings">
                        <h3>Invoice Settings</h3>
                        <!-- Settings content will be added here -->
                    </div>
                    
                    <!-- Tax Settings -->
                    <div class="settings-panel" id="taxSettings">
                        <h3>Tax & Discount Settings</h3>
                        <!-- Settings content will be added here -->
                    </div>
                    
                    <!-- Backup Settings -->
                    <div class="settings-panel" id="backupSettings">
                        <h3>Backup & Restore</h3>
                        <!-- Settings content will be added here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <div class="toast-content">
            <i class="toast-icon"></i>
            <span class="toast-message"></span>
        </div>
        <button class="toast-close">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- JavaScript Files -->
    <script src="../assets/js/utils.js"></script>
    <script src="data/shops.js"></script>
    <script src="data/products.js"></script>
    <script src="data/invoices.js"></script>
    <script src="data/users.js"></script>
    <script src="utils/storage.js"></script>
    <script src="utils/barcode.js"></script>
    <script src="utils/print.js"></script>
    <script src="billing.js"></script>
</body>
</html>

